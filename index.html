<html>
  <head>
    <meta name="viewport" content="width=device-width, initial-scale=1, minimum-scale=1" />
    <link rel="stylesheet" href="index.css" />
    <link rel="stylesheet" href="themify-icons.css" />
  </head>

  <body>
    <section class="dl-blurbs" id="salidas-dominicales" class="visible accordion">
      <dl>
        <dt>Enero - <span class="number_of_activities">0 actividad planificadas</span></dt>
        <dt>Febrero - <span class="number_of_activities">2 actividad planificada</span></dt>
        <dd class="fecha"><span class="ti-timer"></span>04/02/2023 - 09:00 Zorroza (Aplazada desde Enero)</dd>
        <dd class="title">Sasiburu - Senderos Pulmón - Gorostiza XC</dd>
        <dd class="descripcion">Almuerzo en el regato</dd>
        <dd class="descripcion"> 
          Subiremos por Sasiburu hasta el cruce de Saratxo y de ahi para la zona
          del Tojo, donde haremos los 6 km de bajada de la pulmón hasta el
          regato. El que quiera puede jugar un rato en el circuito de Gorostiza.
          Ruta sencilla pero muy divertida
        </dd>
        <dd>47 km / 1100 m</dd>
        <dd class="links">
          <span class="ti-map-alt"></span><a href="https://www.strava.com/routes/3050353739471458302?v2=true">Ruta</a
          >
          <div class="apuntarme">
            <span class="ti-check-box"></span>
            <a href="#" data-id="1" class="apuntame">Apuntarme (<span class="numero_asistentes" data-id="1">0</span> apuntados)</a>
            <form class="no_visible">
              <input type="text" placeholder=" " />
              <button>
                <span class="ti-check"></span>
              </button>
            </form>
          </div>
        </dd>
        <dd class="fecha"><span class="ti-timer"></span>25/02/2023 - 09:00 Miribilla</dd>
        <dd class="title">Oro - Cresta Zamaia - Pagasarri</dd>
        <dd class="descripcion">Almuerzo en el albergue de Somo, antes del Zamaia</dd>
        <dd class="descripcion"> 
          Conocemos la zona, asi que la ruta sera a concretar, pero la idea es
          hacer la cresta del Zamaia, Gongeda y bajar por los senderos del
          ganeko a la pista, para acercanos al paga por el sendero luminoso, a
          partir de ahi o bajar, o seguir con la Raul o a casa.
        </dd>
        <dd>40 km / 1100 m</dd>
        <dd class="links">
          <span class="ti-map-alt"></span><a href="https://www.strava.com/routes/3050362638518786046?v2=true">Ruta</a
          >
          <div class="apuntarme">
            <span class="ti-check-box"></span>
            <a href="#" data-id="2" class="apuntame">Apuntarme (<span class="numero_asistentes" data-id="2">0</span> apuntados)</a>
            <form class="no_visible">
              <input type="text" placeholder=" " />
              <button>
                <span class="ti-check"></span>
              </button>
            </form>
          </div>        
        </dd>
        <dt>Marzo - <span class="number_of_activities">1 Actividad planificada</span></dt>
        <dd class="fecha"><span class="ti-timer"></span>18/03/2023 - 09:00 Arrazola</dd>
        <dd class="title">Vuelta a Anboto</dd>
        <dd class="descripcion">Almuerzo en el txoko de Marmi (Hay duchas)</dd>
        <dd class="descripcion"> 
          Vuelta a Anboto, ruta preparada por Paul, para todos los públicos para hacer hambre ;)
        </dd>
        <dd>35 km/ 1100</dd>
        <dd class="links">
          <span class="ti-map-alt"></span>Por definir
          <div class="apuntarme">
            <span class="ti-check-box"></span>
            <a href="#" data-id="3" class="apuntame">Apuntarme (<span class="numero_asistentes" data-id="3">0</span> apuntados)</a>
            <form class="no_visible">
              <input type="text" placeholder=" " />
              <button>
                <span class="ti-check"></span>
              </button>
            </form>
          </div>        
        </dd>
        <dd>26/03/2023</dd>
        <dd>Proximamente</dd>
        <dt>Abril</dt>
        <dd>30/04/2023</dd>
        <dd>Proximamente</dd>
        <dt>Mayo</dt>
        <dd>28/05/2023</dd>
        <dd>Proximamente</dd>
        <dt>Junio</dt>
        <dd>25/06/2023</dd>
        <dd>Proximamente</dd>
        <dt>Julio</dt>
        <dd>30/07/2023</dd>
        <dd>Proximamente</dd>
        <dt>Agosto</dt>
        <dd>27/08/2023</dd>
        <dd>Proximamente</dd>
        <dt>Septiembre</dt>
        <dd>24/09/2023</dd>
        <dd>Proximamente</dd>
        <dt>Octubre</dt>
        <dd>29/10/2023</dd>
        <dd>Proximamente</dd>
        <dt>Noviembre</dt>
        <dd>26/11/2023</dd>
        <dd>Proximamente</dd>
        <dt>Diciembre</dt>
        <dd>24/11/2023</dd>
        <dd>Proximamente</dd>
      </dl>
    </section>
    <script type="module">

      // Import the functions you need from the SDKs you need
      import { initializeApp } from "https://www.gstatic.com/firebasejs/9.16.0/firebase-app.js";
      import {
        getDatabase,
        ref,
        set,
        onValue,
        push
      } from "https://www.gstatic.com/firebasejs/9.16.0/firebase-database.js";
      
      let events = [];

      // Your web app's Firebase configuration
      const firebaseConfig = {
        apiKey: "AIzaSyDmIzzkiWaoBA3lds7WtwZ7agmOOcbUvKI",
        authDomain: "miribilla-btt.firebaseapp.com",
        databaseURL:
          "https://miribilla-btt-default-rtdb.europe-west1.firebasedatabase.app",
        projectId: "miribilla-btt",
        storageBucket: "miribilla-btt.appspot.com",
        messagingSenderId: "62295771452",
        appId: "1:62295771452:web:721326eb5bca68e1647639",
      };

      // Initialize Firebase
      const app = initializeApp(firebaseConfig);
      const database = getDatabase(app);

      const buttons = document.querySelectorAll("button");
      buttons.forEach((button) => {
        button.addEventListener("click", (onClickEvent) => {
          onClickEvent.preventDefault();
          const form = onClickEvent.target.closest("form");
          const apuntarme = onClickEvent.target.closest(".apuntarme");
          const inputValue = form.querySelector("input").value;
          form.classList = "no_visible";
          form.reset();
          const id = apuntarme.querySelector("a").dataset.id;
          let event = events.find(event => event.id === id);
          if (event) {
            event.asistentes.push(inputValue);
          } else {
            event =  {
              id: id,
              asistentes: [inputValue]
            }
          }
        
          set(ref(database, "salidas_domingo/"), [...events.filter(event => event.id !== id), event]);
        });
      });

      const buttonApuntame = document.querySelectorAll(".apuntame");
      buttonApuntame.forEach((button) => {
        button.addEventListener("click", (event) => {
          event.preventDefault();
          event.target.parentElement.querySelector("form").classList = "visible";
        });
      });
    
      const salidasDomingo = ref(database, 'salidas_domingo/');
      onValue(salidasDomingo, (snapshot) => {
        const data = snapshot.val();
        events = data || [];
        events.forEach(d => {
          document.querySelector(`span[data-id="${d.id}"]`).setHTML(d.asistentes.length);
        });
      });
    </script>
  </body>
</html>
